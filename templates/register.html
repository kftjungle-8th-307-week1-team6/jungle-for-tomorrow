<!DOCTYPE html>
<html lang="ko">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  <!-- 이 부분은 절대 지우지 마세요. -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
  <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
    crossorigin="anonymous"></script>
  <!-- 이 부분은 절대 지우지 마세요. -->
  <style>
    * {
      box-sizing: border-box;
      font-family: "Gothic";
    }

    .container {
      max-width: 1000px;
      width: 90%;
      margin: auto;
      padding: 30px;
      border: 2px dotted green;
      border-radius: 20px;
      margin-top: 1vh;
    }

    .row {
      height: auto;
      min-height: 50px;
    }

    input {
      width: 100%;
      border: 1px solid lightgray;
      border-radius: 5px;
      padding: 5px 10px;
    }

    input[readonly] {
      background-color: #f2f2f2;
      color: #b3b3b3;
    }

    input[readonly]:hover {
      box-shadow: none;
      cursor: default;
    }

    a {
      text-decoration-line: none;
      color: black;
    }

    #nameBox,
    #idBox,
    #pwBox,
    #pwCheckBox,
    #nicknameBox {
      color: red;
      font-weight: bold;
    }

    #registerBox {
      font-size: 40px;
      font-weight: bold;
    }

    #btnrow {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }

    .btnCol {
      display: flex;
      gap: 10px;
      justify-content: space-between;
    }

    #register {
      margin-left: 15px;
    }

    .logoBox {
      text-align: center;
      font-size: 3rem;
      margin-top: 10vh;
    }

    @media (max-width: 767px) {
      .inputBox {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
        margin-bottom: 10px;
      }

      .inputBox .col-2,
      .inputBox .col-10,
      .inputBox .col-8 {
        width: 100%;
        max-width: 100%;
      }

      .inputBox .col-2 button {
        width: auto;
        min-width: 80px;
      }

      .logoBox {
        margin-top: 1vh;
      }

      #register {
        margin-left: 0;
      }

    }

    @media (min-width: 768px) {
      .inputBox {
        flex-wrap: nowrap;
      }

      .inputBox .col-2 {
        flex: 1 1 auto;
        max-width: 20%;
      }

      .inputBox .col-10,
      .inputBox .col-8 {
        flex: 1 1 auto;
      }

      .inputBox .col-2 button {
        width: auto;
      }
      
    }
  </style>
  <title>내일은 정글 회원가입</title>
</head>

<body>
  <div class="logoBox" style="font-weight: bold;">
    <img src="{{ url_for('static', filename='logo.jpg')}}" alt="" width="60" height="57"> 내일은 정글
  </div>
  <div class="container">
    <form action="/user/signup" id="joinForm" method="post">
      <div class="row mb-4 ms-1" id="registerBox">
        <div class="col-12 col-lg-6">
          <a href="#" data-bs-toggle="tooltip" data-bs-placement="bottom" data-bs-title="
                어떤 항목도 적색이 아니어야 가입할 수 있습니다.
                " class="d-flex align-items-center"> 회원가입</a>
        </div>
      </div>
      <div class="row inputBox">
        <div class="col-2 d-flex justify-content-start align-items-center" id="nameBox">이름</div>
        <div class="col-10 d-flex justify-content-start align-items-center">
          <input type="text" id="name" name="name" placeholder="한글 2~5자">
        </div>
      </div>
      <div class="row inputBox">
        <div class="col-2 d-flex justify-content-start align-items-center" id="idBox">아이디</div>
        <div class="col-8 d-flex justify-content-start align-items-center">
          <input type="text" id="id" name="id" placeholder="영문 소문자,숫자,_로 구성된 6~20자" maxlength="20">
        </div>
        <div class="col-2 d-flex justify-content-start align-items-center">
          <button type="button" class="btn btn-outline-primary" id="idCheck">중복체크</button>
        </div>
      </div>
      <div class="row inputBox">
        <div class="col-2 d-flex justify-content-start align-items-center" id="pwBox">패스워드</div>
        <div class="col-10 d-flex justify-content-start align-items-center">
          <input type="password" id="pw" name="pw" placeholder="영문 대/소문자,숫자 필수, 8자리 이상">
        </div>
      </div>
      <div class="row inputBox">
        <div class="col-2 d-flex justify-content-start align-items-center" id="pwCheckBox">패스워드 확인</div>
        <div class="col-10 d-flex justify-content-start align-items-center">
          <input type="password" id="pwCheck" placeholder="패스워드 재입력">
        </div>
      </div>
      <div class="row inputBox">
        <div class="col-2 d-flex justify-content-start align-items-center" id="nicknameBox">닉네임</div>
        <div class="col-8 d-flex justify-content-start align-items-center">
          <input type="text" id="nickname" name="nickname" placeholder="최대 10자" maxlength="10">
        </div>
        <div class="col-2 d-flex justify-content-start align-items-center">
          <button type="button" class="btn btn-outline-primary" id="nicknameCheck">중복체크</button>
        </div>
      </div>
      <div class="row inputBox">
        <div class="col-2 d-flex justify-content-start align-items-center" id="divisionBox">소속</div>
        <div class="col-12 col-md-3 d-flex justify-content-start align-items-center">
          <select class="form-select" aria-label="division_select" name="division" id="division">
            <option selected value="정글">정글</option>
            <option value="정글 게임랩">정글 게임랩</option>
            <option value="정글 게임테크랩">정글 게임테크랩</option>
          </select>
        </div>
        <div class="col-2 d-flex justify-content-start align-items-center">
          <input type="number" class="form-control" min="1" max="100" step="1" value="8" name="generation"
            id="generation">&nbsp;기
        </div>
      </div>
      <div class="row" id="btnrow">
        <div class="col-12 mt-3 btnCol">
          <button type="button" class="btn btn-outline-dark" id="return">돌아가기</button>
          <button type="submit" class="btn btn-outline-success" id="register">가입하기</button>
        </div>
      </div>
    </form>
  </div>

  <script>
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))

    $("#name").on("keyup", function () {
      let regex = /^[가-힣]{2,5}$/;
      let isCor = regex.test($("#name").val());

      if (isCor) {
        $("#nameBox").css("color", "green");
      } else {
        $("#nameBox").css("color", "red");
      }

    });

    $("#id").on("keyup", function () {
      let regex = /^[a-z0-9_]{6,20}$/;
      let isCor = regex.test($("#id").val());

      if (isCor) {
        $("#idBox").css("color", "blue");
      } else {
        $("#idBox").css("color", "red");
      }
    });

    $("#pw").on("keyup", function () {
      let reg = /^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9]).{8,}$/;
      let isCor = reg.test($("#pw").val());

      if (isCor) {
        $("#pwBox").css("color", "green");
      } else {
        $("#pwBox").css("color", "red");
      }
    })

    $("#pwCheck").on("keyup", function () {
      if ($("#pw").val() == $("#pwCheck").val()) {
        $("#pwCheckBox").css("color", "green");
      } else {
        $("#pwCheckBox").css("color", "red");
      }
    });

    $("#joinForm").on("submit", function (e) {
      if ($("#nameBox").css("color") == "rgb(255, 0, 0)") {
        alert("이름을 입력하지 않았거나 올바르지 않습니다.");
        e.preventDefault();
      } else if ($("#idBox").css("color") == "rgb(255, 0, 0)") {
        alert("아이디를 입력하지 않았거나 올바르지 않습니다.");
        e.preventDefault();
      } else if ($("#idBox").css("color") == "rgb(0, 0, 255)") {
        alert("아이디 중복체크를 진행해주세요!");
        e.preventDefault();
      } else if ($("#pwBox").css("color") == "rgb(255, 0, 0)") {
        alert("비밀번호를 입력하지 않았거나 올바르지 않습니다.");
        e.preventDefault();
      } else if ($("#pwCheckBox").css("color") == "rgb(255, 0, 0)") {
        alert("비밀번호를 올바르게 다시 입력해주세요");
        e.preventDefault();
      } else if ($("#nicknameBox").css("color") == "rgb(255, 0, 0)") {
        alert("닉네임 중복체크를 진행해주세요!");
        e.preventDefault();
      }
      let isRightDepartment = confirm($("#division").val() + " " + $("#generation").val() + "기 " + $("#name").val() + " 님으로 가입하시겠습니까?");
      if (!isRightDepartment) {
        e.preventDefault();
      }
    });

    $("#idCheck").on("click", function () {
      if ($("#id").val().trim() == "") {
        alert("아이디를 입력해주세요!");
        return;
      } else {
        let regex = /^[a-z0-9_]{6,20}$/;
        let isCor = regex.test($("#id").val());

        if (!isCor) {
          alert("아이디 형식이 올바르지 않습니다!");
          return;
        } else {
          $.ajax({
            type: "POST",
            url: "/user/idCheck",
            data: {
              id: $("#id").val()
            }
          }).done(function (resp) {
            if (resp.result === true) {
              let isIdUse = confirm("사용 가능한 아이디입니다. 사용하시겠습니까?");
              if (isIdUse) {
                $("#idBox").css("color", "green");
              } else {
                $("#idBox").css("color", "blue");
              }
            } else {
              alert("이미 사용중인 ID입니다. 다른 ID를 사용해주세요!");
            }
          });
        }
      }
    });

    $("#nicknameCheck").on("click", function () {
      if ($("#nickname").val().trim() == "") {
        alert("닉네임을 입력해주세요!");
        return;
      } else {
        $.ajax({
          type: "POST",
          url: "/user/nicknameCheck",
          data: {
            nickname: $("#nickname").val()
          }
        }).done(function (resp) {
          if (resp.result === true) {
            let isNicknameUse = confirm("사용 가능한 닉네임입니다. 사용하시겠습니까?");
            if (isNicknameUse) {
              $("#nicknameBox").css("color", "green");
            } else {
              $("#nicknameBox").css("color", "blue");
            }
          } else {
            alert("이미 사용중인 닉네임입니다. 다른 닉네임을 사용해주세요!");
          }
        });
      }
    });

    $("#return").on("click", function () {
      location.href = "{{ url_for('main.login_page') }}";
    });
  </script>
</body>

</html>